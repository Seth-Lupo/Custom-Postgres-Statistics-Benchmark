<!--
PostgreSQL Statistics Estimator - Experiment Configuration Form Component

This template partial contains the main experiment setup form with all
the necessary fields for configuring and launching an experiment.

Variables Expected:
- src: List of available statistics sources
- dump_files: List of available database dump files
- query_files: List of available query files
- queries_not_available: Boolean indicating if queries are available

Author: Generated by Assistant
Created: 2024
-->

<form hx-post="/experiment" hx-target="#experiment-container" hx-indicator="#submit-spinner"
      hx-swap="innerHTML show:top" class="needs-validation" id="experiment-form" novalidate>
    
    <!-- Experiment Name Row -->
    <div class="row">
        <div class="col-12 mb-3">
            <label for="experiment_name" class="form-label">
                <i class="bi bi-tag me-1"></i>
                Experiment Name
            </label>
            <input type="text" class="form-control" id="experiment_name" name="experiment_name"
                   placeholder="Enter a descriptive name for this experiment" required>
            <div class="form-text">Give your experiment a unique, descriptive name</div>
        </div>
    </div>
    
    <!-- Statistics Source and Iterations Row -->
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="stats_source" class="form-label">
                <i class="bi bi-database me-1"></i>
                Statistics Source
            </label>
            <select class="form-select" id="stats_source" name="stats_source" required
                    onchange="loadSettingsAndConfigurations(this.value)">
                <option value="" disabled selected>Select a statistics source</option>
                {% for key, name in src %}
                <option value="{{ key }}">{{ name }}</option>
                {% endfor %}
            </select>
            <div class="form-text">Choose the statistics source to use for query planning</div>
        </div>
        <div class="col-md-6 mb-3">
            <label for="iterations" class="form-label">
                <i class="bi bi-arrow-repeat me-1"></i>
                Number of Iterations
            </label>
            <div class="input-group">
                <input type="number" class="form-control" id="iterations" name="iterations" 
                       value="10" min="1" max="10000" required>
                <span class="input-group-text">times</span>
            </div>
            <div class="form-text">Number of trials (1-10000)</div>
        </div>
    </div>
    
    <!-- File Selection Row -->
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="dump_file" class="form-label">
                <i class="bi bi-database-fill me-1"></i>
                Database Dump File
            </label>
            <select class="form-select" id="dump_file" name="dump_file" required>
                <option value="" disabled selected>Select a dump file</option>
                {% for file in dump_files %}
                <option value="{{ file }}">{{ file }}</option>
                {% endfor %}
            </select>
            <div class="form-text">Choose the database dump to restore before running the experiment</div>
        </div>
        <div class="col-md-6 mb-3">
            <label for="query_file" class="form-label">
                <i class="bi bi-file-earmark-code me-1"></i>
                Query File
            </label>
            <select class="form-select" id="query_file" name="query_file" required>
                <option value="" disabled selected>Select a query file</option>
                {% for file in query_files %}
                <option value="{{ file }}">{{ file }}</option>
                {% endfor %}
            </select>
            <div class="form-text">Choose the SQL queries file to benchmark</div>
        </div>
    </div>
    
    <!-- Settings and Configuration Row -->
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="settings_name" class="form-label">
                <i class="bi bi-sliders me-1"></i>
                Runtime Settings
            </label>
            <div class="input-group">
                <select class="form-select" id="settings_name" name="settings_name" disabled>
                    <option value="" disabled selected>Select a statistics source first</option>
                </select>
                <button type="button" class="btn btn-outline-secondary" id="edit-settings-btn" disabled
                        onclick="openSettingsEditor()">
                    <i class="bi bi-pencil-square me-1"></i>
                    Edit
                </button>
            </div>
            <div class="form-text">Choose runtime settings (timeouts, memory, statistics reset strategy, etc.)</div>
            <!-- Hidden field to store the edited YAML settings -->
            <input type="hidden" id="settings_yaml" name="settings_yaml" value="">
        </div>
        <div class="col-md-6 mb-3">
            <label for="config_name" class="form-label">
                <i class="bi bi-gear me-1"></i>
                Configuration
            </label>
            <div class="input-group">
                <select class="form-select" id="config_name" name="config_name" disabled>
                    <option value="" disabled selected>Select a statistics source first</option>
                </select>
                <button type="button" class="btn btn-outline-secondary" id="edit-config-btn" disabled
                        onclick="openConfigEditor()">
                    <i class="bi bi-pencil-square me-1"></i>
                    Edit
                </button>
            </div>
            <div class="form-text">Choose configuration for the selected statistics source</div>
            <!-- Hidden field to store the edited YAML configuration -->
            <input type="hidden" id="config_yaml" name="config_yaml" value="">
        </div>
    </div>

    <!-- Submit Button -->
    <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary" id="run-experiment-btn">
            <span id="submit-spinner" class="spinner-border spinner-border-sm me-2 htmx-indicator"
                  role="status" aria-hidden="true"></span>
            <i class="bi bi-play-fill me-1"></i>
            Run Experiment
        </button>
    </div>
</form> 